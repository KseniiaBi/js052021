<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1"> 

	<style>
	*{
		box-sizing: border-box;
		margin: 0;
		padding: 0;
	}

	body {
		padding: 30px;
		text-align: center;
		font-size: 18px;
	}

	h1, h3, form{
		margin-bottom: 50px;
	}

	input{
		width: 300px;
		height: 40px;
		outline: none;
		border: 1px solid #333;
		border-width: 0 0 1px;
		margin-bottom: 30px;
	}

	#savebtn {
		width: 100px;
		background: lightgreen;
		border: none;
		text-transform: uppercase;
		color: #fff;
		font-size: 20px;
	}

	.defs, .hidden{
		display: none;
	}

	ol, li {
		text-align: left;
	}

	.done {
		text-decoration: line-through;
	}

	svg{
		width: 22px;
		height: 22px;
		margin-left: 22px; 
		cursor: pointer;
		position: relative;
	}

	svg>g{
		display: block;
		position: absolute;
		width: 100%;
		height: 100%;
		z-index: 111;
	}

	</style>
</head>
<body>


	<h1>To Do List</h1>

 	<form id="todoform">
 		<input id="textinput" type="text" placeholder="Type your task here">
 		<input id="savebtn" type="submit" value="Save">
 	</form>

 	<h3>Any tasks yet. Type your first in input above</h3>

 	<ol class="todolist"></ol>



<div class="defs">

	<svg class="edit" enable-background="new 0 0 512.002 512.002" height="30" viewBox="0 0 512.002 512.002" width="30" xmlns="http://www.w3.org/2000/svg"><path d="m448.362 63.64-63.64-63.64-74.246 74.247 53.034 137.886z" fill="#ff3e3a"/><path d="m448.362 63.64-116.672 116.673 106.066 21.213 74.246-74.246z" fill="#cc3245"/><path d="m34.216 406.504-34.216 105.497 112.284-69.856z" fill="#373e9f"/><path d="m.002 512.001 105.497-34.215-14.428-56.854z" fill="#340d66"/><path d="m188.374 366.055-127.279-42.426-26.879 82.875 35.641 35.641z" fill="#ffe7b5"/><path d="m69.857 442.145 35.642 35.641 82.874-26.878-21.213-106.066z" fill="#ffd06a"/><path d="m124.734 387.269 63.639 63.639 249.383-249.382-63.64-63.639-166.169 81.316z" fill="#ff9a27"/><path d="m41.266 185.758h352.679v90h-352.679z" fill="#ffb820" transform="matrix(.707 -.707 .707 .707 -99.435 221.458)"/></svg>

	<svg class="delete" enable-background="new 0 0 512 512" height="30" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg"><path d="m415.158 85.758c-.268.087-93.932 27.686-94.198 27.777-10.041 3.493-16.788 12.983-16.788 23.614v42.223c0 8.285 6.716 15.001 15.001 15.001h114.008c8.285 0 15.001-6.716 15.001-15.001v-69.935c0-17.077-16.817-29.172-33.024-23.679z" fill="#ff5e94"/><path d="m160.161 164.371v282.624c0 35.844 29.161 65.005 65.005 65.005h158.012c35.844 0 65.005-29.161 65.005-65.005 0-15.734 0-274.731 0-282.624z" fill="#9dcfff"/><path d="m304.172 164.371v347.629h79.006c35.843 0 65.005-29.162 65.005-65.005v-282.624z" fill="#72bbff"/> <path fill="#5a5a5a" d="m237.431 233.376c-8.285 0-15.001 6.716-15.001 15.001v179.616c0 8.285 6.716 15.001 15.001 15.001s15.001-6.716 15.001-15.001v-179.616c0-8.285-6.717-15.001-15.001-15.001z"/><path fill="#5a5a5a" d="m304.171 233.376c-8.285 0-15.001 6.716-15.001 15.001v179.616c0 8.285 6.716 15.001 15.001 15.001s15.001-6.716 15.001-15.001v-179.616c0-8.285-6.716-15.001-15.001-15.001z"/><path fill="#444" d="m319.172 248.381v179.613c0 8.281-6.72 15.001-15.001 15.001v-209.615c8.281 0 15.001 6.71 15.001 15.001z"/><path d="m370.912 233.376c-8.285 0-15.001 6.716-15.001 15.001v179.616c0 8.285 6.716 15.001 15.001 15.001s15.001-6.716 15.001-15.001v-179.616c0-8.285-6.716-15.001-15.001-15.001z"/><path d="m192.17 18.07s0 0-.01 0c-15.336-9.588-36.016-7.793-49.46 5.65v.01l-27.58 27.57-27.58 27.58c-15.6 15.6-15.6 40.98 0 56.57l14.15 14.15 20.31-2.1.9-19.12-14.14-14.14c-3.9-3.9-3.9-10.25 0-14.14l27.58-27.58 27.57-27.58h.01c3.689-3.689 10.025-4.116 14.13-.01l14.15 14.15 18.55-3.08 2.67-18.13c-14.806-14.806-16.41-16.818-21.25-19.8z" fill="#5a5a5a"/><path d="m192.17 18.07s0 0-.01 0c-15.297-9.564-35.968-7.831-49.46 5.66l-27.58 27.57 21.22 21.22 27.58-27.58c3.686-3.686 10.017-4.124 14.13-.01l14.15 14.15 21.22-21.21c-15.291-15.291-16.162-16.574-21.25-19.8z" fill="#444"/><path d="m317.418 37.108-26.872-26.872c-13.647-13.647-35.853-13.647-49.501 0l-166.992 166.991c-13.647 13.647-13.647 35.853 0 49.501l26.872 26.872c5.857 5.858 15.356 5.859 21.214 0l195.279-195.278c5.858-5.858 5.858-15.356 0-21.214z" fill="#3ba9ff"/><path d="m290.545 10.236 26.872 26.872c5.855 5.855 5.862 15.352 0 21.215l-97.637 97.637-62.23-62.23 83.494-83.494c13.648-13.648 35.853-13.648 49.501 0z" fill="#0081ff"/></svg>

</div>

<script>

//  внешний вид + 
// добавление задачи + 
// пометить выполненной + 
// удаление задачи +
// редактирование задачи +
// сохранение состояния приложения 

const savebtn = document.getElementById('savebtn');
const todolist = document.getElementsByClassName('todolist')[0];
const form = document.getElementsByTagName('form')[0];
const input = document.querySelector('#textinput');
const heading = document.getElementsByTagName('h3')[0];
const storage = window.localStorage;
const STORNAME = 'MyToDo';
let todos;

if(storage.getItem(STORNAME) && JSON.parse(storage.getItem(STORNAME)).length > 0){
	todos = JSON.parse(storage.getItem(STORNAME)); // если что-то было в хранилище, копируем это в массив
	buildList();
}
else{
	todos = []; // если нет - todos - это пустой массив
}

function checkTodos(){
	if(todos.length < 1){
		// можно работать с классом .hidden
		heading.style.display = 'block';
		todolist.style.display = 'none';
	}
	else{
		heading.style.display = 'none';
		todolist.style.display = 'block';
	}
}

checkTodos();

// submit - enter || savebtn click
form.onsubmit = function(event){
	event.preventDefault();
	saveTask();
}

function buildList(){
	for(let task of todos){
		createLi(task.id, task.task);
	}
}

function createLi(id, todo){
	let li = document.createElement('li');
	li.id = id;
	let textElem = document.createElement('span');
	textElem.innerText = todo;
	li.append(textElem);

	let editInput = document.createElement('input');
	editInput.classList.add('hidden');
	li.append(editInput);

	// обработчик нажатий кнопок на поле радактирования
	editInput.onkeyup = function(event){
		if(event.keyCode == 13){ // если нажали Enter
			textElem.innerText = editInput.value; // присваиваем значение инпута в спан
			editInput.classList.add('hidden'); // прячем инпут
			textElem.classList.remove('hidden'); // показываем спан

			todos.forEach((item, index) => { // редактируем элемент в массиве
				if(item.id == id){
					item.task = editInput.value; // заменяем значение в массиве
				}
			});
			saveToLS();
		}
	}

	let editBtn = document.querySelector('.edit').cloneNode(true);
	li.append(editBtn);

	let delBtn = document.querySelector('.delete').cloneNode(true);
	li.append(delBtn);

// после того, как мы наполнили наш li, мы вставляем его в список
	todolist.append(li);
}


function saveTask(){
	let id = Date.now(); // уникальное число, сколько мс прошло от начала Unix  эпохи
	let todo = input.value; // текст из поля формы
	todos.push({
		task: todo,
		id: id
	});

	createLi(id, todo);

	
	input.value = ''; // и очищаем форму
	if(todos.length == 1){
		checkTodos();// и проверяем надо ли  убирать заголовок
	} 
	saveToLS();
}

// обработчик всех наших кликов, принимаем в нем параметр - событие, которое произошло и содержит в себе информацию о том где и как оно произошло
document.addEventListener('click', function(event){
	if(event.target.tagName.toLowerCase() == 'li'){ // если мы кликнули на li, зачеркиваем ее (или отменяем зачеркивание)
		event.target.classList.toggle('done');
	}
	if(event.target.classList.contains('delete') || event.target.parentNode.classList.contains('delete')){ // если мы нажали на элемент svg или его дочерний path из иконки корзины
		let id; // определяем id элемента, по которому кликнули
		if(event.target.tagName.toLowerCase() == 'svg'){
			id = event.target.parentNode.id; // если это svg, li - его parentNode
		}
		else{
			id = event.target.parentNode.parentNode.id;// если это path, li - его parentNode.parentNode (прародитель)
		}
		deleteTask(id, completeDeletion, declineDeletion);//  вызываем окно удаления
	}
	if(event.target.classList.contains('edit') || event.target.parentNode.classList.contains('edit')){// если мы нажали на элемент svg или его дочерний path из иконки карандаша
		let id; // определяем id элемента, по которому кликнули
		if(event.target.tagName.toLowerCase() == 'svg'){
			id = event.target.parentNode.id; // если это svg, li - его parentNode
		}
		else{
			id = event.target.parentNode.parentNode.id;// если это path, li - его parentNode.parentNode (прародитель)
		}
		editTask(id);//  вызываем редактирование
	}
});

function deleteTask(id, allow, decline){ // айди, колбэк удаления, колбэк отмены
	confirm('Are you sure you want to delete task?') ? allow(id) : decline(); // confirm возвращает true || false и в зависимости от этого вызываем колбэк
}

function completeDeletion(id){ 
	// cначала удаляем в массиве 
	todos.forEach((item, index) => {
		if(item.id == id){
			todos.splice(index, 1);
		}
	});
	// потом в верстке
	let li = document.getElementById(id);
	li.remove();

	if(todos.length == 0){
		checkTodos();
	}
	saveToLS();
}

function declineDeletion(){
	// если бы у вас было кастомное модальное окошко , то здесь его мы закрываем
	console.log('Deletion was not completed');
}

function editTask(id){
	let li = document.getElementById(id);
	let input = li.querySelector('input');
	let span = li.querySelector('span');
	input.value = span.innerText;
	input.classList.remove('hidden');
	span.classList.add('hidden');
}

function saveToLS(){
	let jsonTodos = JSON.stringify(todos);
	storage.setItem(STORNAME, jsonTodos);
}



</script>

</body>
</html>
